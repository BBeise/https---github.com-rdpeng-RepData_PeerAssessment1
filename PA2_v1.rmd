---
title: "Peer Assessment 2"
author: "Beise"
date: "July 26, 2015"
output: html_document
---
##Storm Event Impact Analysis in United States

###Synopsis

In this report we aim to explore the NOAA Storm Database and answer questions about the health and quantifiable damage impacts of recorded weather events. Our results should be useful to public officials preparing readiness, emergency response programs in their jurisdictions, as well as preparing response budgets.  To investigate these areas, we obtained storm event data from the National Climatic Data Storm Center (NCDC). Our summary findings indicate that the top [five] weather events across the United States producing significant health impacts, measured as fatalities and injuries, are the following: [Tornados, Hurricanes, ]. Furthermore, the most significant economic consequences, measured as crop and property damage, are due to [Tornados, Hurricanes].



###Data Processing
####Loading the Data

From the NCDC we obtained the files for the years 1950 through November 2011.
```{r get data,results="hide"}
## Getting the Data
fileUrl<-"https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
download.file(fileUrl,destfile="weather.csv",method="curl")
```
####Reading in the data

Having downloaded the data as a compressed csv file, we read it in its entirety into a local file, and check that the file is formatted as a data frame.
```{r read and refine the data,results="hide"}
weather <- read.csv("weather.csv",header=TRUE)
# load useful packages
library(dplyr)
```
###Data Analysis
##Data Inspection & Transformation
Using summary analysis, we check to see whether key health or damage information is missing (i.e. coded as NA).
```{r summary na}
summary(weather[,c("EVTYPE","FATALITIES","INJURIES","PROPDMG","CROPDMG")])
```
Because none of the key variables include missing values, missing values are not a problem in this analysis.
We then reduce the file to the relevant variables for the analysis
```{r file reduce}
#pare down the file to the relevant variables
weatherdat<-weather[,c("BGN_DATE","STATE","EVTYPE","FATALITIES","INJURIES","PROPDMG","CROPDMG","REFNUM")]
attach(weatherdat)
weatherdat$health<-FATALITIES+INJURIES
weatherdat$damage<-PROPDMG+CROPDMG
```
####Identifying Health Impacts

To perform the analysis on health impacts, we create a subset of the weather data that generates the relevant statistics.
```{r health impacts}
#create table of health impacts by type
badhealth<-group_by(weatherdat,EVTYPE)
badhealth<-summarise(badhealth,healthsum=sum(health))
#create table of health impacts by type
badhealth<-group_by(weatherdat,EVTYPE)
badhealth<-summarise(badhealth,healthsum=sum(health))
qbadhealth<-quantile(badhealth$healthsum,seq(0,1,by=0.01))
badhealth$impgroups<-cut(badhealth$healthsum,unique(qbadhealth),include.lowest=TRUE)
```
Next we plot the grouped dataset to see the distribution of health impacts
```{r distribution,fig.height=4,echo=FALSE}
hist(log(badhealth$healthsum),main="Distribution of Health Impact Size by Event Type")
```

As we can see from the above, very few event types generate the largest proportion of fatilities and injuries.  

Next we identify the top ten event types that can be considered most costly. We generate the table to identify the number of impact groups.

``` {r find htop ten}
table(badhealth$impgroups)
hlevels<-levels(badhealth$impgroups)
topten<-filter(badhealth,badhealth$impgroups==hlevels[16])
```
####Identifying Economic Impacts

To perform the analysis on event economic impacts, we create a subset of the weather data that generates the relevant statistics.
``` {r economic impacts}
bigdamages<-group_by(weatherdat,EVTYPE)
bigdamages<-summarise(bigdamages,damagesum=sum(damage))
qdamages<-quantile(bigdamages$damagesum,seq(0,1,by=0.01))
bigdamages$impgroups<-cut(bigdamages$damagesum,unique(qdamages),include.lowest=TRUE)
```
Next we plot the grouped dataset to see the distribution of economic impacts.
``` {r plot economic impact distribution,fig.height=4}
hist(log(bigdamages$damagesum))
```

As with the health impacts, a relatively few event types generate the largest damages.

Next we identify the top ten event types and their total crop and property damages. We first generate a table of the impact groupings to isolate the top ten.
``` {r find etop ten}
table(bigdamages$impgroups)
hlevels<-levels(bigdamages$impgroups)
dtopten<-filter(bigdamages,bigdamages$impgroups==hlevels[36])
```

##Results

###Health Impacts

The top ten events generating the majority of fatalities and injuries are as follows in the table below.  It is clear that Tornados trump all other weather events for impacts on life and limb.

```{r health results}
topten[,1:2]
```
###Economic Impacts

Results for the economic impact analysis are similar, although tornados do not skew as highly as they do for the health impacts.

```{r economic results}
dtopten[,1:2]
```
